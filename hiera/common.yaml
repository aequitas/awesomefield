classes:
  - base
  - awesome
  - mailman
  - apache::params
  - mailman::apache
  - mailman::postfix
  - nginx

# basic firewall config

firewall:
  100 allow related, established:
    proto: all
    state:
      - RELATED
      - ESTABLISHED
    action: accept
  100 allow icmp:
    proto: icmp
    action: accept
  100 allow local:
    proto: all
    iniface: lo
    action: accept
  200 allow ssh:
    port: ssh
    action: accept
  300 allow http traffic in:
    port: http
    action: accept
  300 allow https traffic in:
    port: https
    action: accept
  300 allow mail from diggie:
    port: 25
    source: 217.198.23.134/32
    action: accept
  999 drop the rest:
    action: drop

hosts:
  "%{hiera('mailman::http_hostname')}":
    ip: 127.0.0.1

# configure mailman mailing lists

mailman::enable_service: true
mailman::site_pw: geheim
mailman::mta: Postfix
mailman::smtp_hostname: awesomeretro.com
mailman::http_hostname: lists.awesomeretro.com

mailman::apache::mailman_cgi_dir: /usr/lib/cgi-bin/mailman/
mailman::apache::mailman_icons_dir: /usr/share/images/mailman/
mailman::apache::port: 8081

awesome::maillist::admin: mail@ijohan.nl
awesome::maillist::password: geheim

maillists:
  info:
    description: ''
    mailserver: awesomeretro.com
  bestuur:
    description: Mailing list for board members
    mailserver: awesomeretro.com
  it:
    description: Mailing list for IT personel
    mailserver: awesomeretro.com
  crew:
    description: Public list for
    mailserver: awesomeretro.com
  tv:
    description: ''
    mailserver: awesomeretro.com
  redactie:
    description: ''
    mailserver: awesomeretro.com
  donaties:
    description: ''
    mailserver: awesomeretro.com

nginx::nginx_vhosts:
  lists.awesomeretro.com:
    server_name:
      - lists.awesomeretro.com
      - "lists.%{::fqdn}"
    proxy: http://127.0.0.1:8081
nginx::nginx_locations:
  icons:
    vhost: lists.awesomeretro.com
    location: '~ "^(/doc/mailman/images|/images/mailman)/(.*(png|jpg|gif))$"'
    location_alias: /usr/share/images/mailman/$2
